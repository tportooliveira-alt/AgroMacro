<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AgroMacro</title>
    <link rel="stylesheet" href="styles.css?v=20260211q">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
    <!-- Leaflet.js ‚Äî Mapa Interativo (gr√°tis) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <meta name="theme-color" content="#0F1318">
</head>

<body>

    <!-- Header -->
    <header class="app-header">
        <div class="logo-container">
            <svg class="logo-svg" width="32" height="32" viewBox="0 0 100 100">
                <path
                    d="M15 75 Q15 45 35 35 Q45 30 55 35 Q65 40 68 50 L85 45 Q88 42 90 45 L88 50 Q85 52 82 50 L70 54 Q72 62 68 70 L72 85 L65 85 L62 72 Q55 78 45 78 Q38 78 32 72 L30 85 L23 85 L27 70 Q22 62 22 55"
                    fill="#D4A843" />
                <circle cx="40" cy="42" r="3" fill="#0F1318" />
            </svg>
            <h1>AgroMacro</h1>
        </div>
        <button id="menu-btn" class="icon-btn" onclick="window.app.navigate('config')"><span data-icon="config"
                style="width:20px;height:20px;display:inline-flex;"></span></button>
    </header>

    <main id="app-container">

        <!-- ===================== HOME ===================== -->
        <section id="view-home" class="view active">

            <!-- Hero Greeting -->
            <div class="hero-greeting">
                <div class="greeting-text" id="greeting-text">Boa tarde</div>
                <div class="greeting-sub" id="greeting-date"></div>
            </div>

            <!-- ‚ïê‚ïê HOME CAMPO (Pe√£o/Manuten√ß√£o) ‚Äî Bot√µes grandes, sem valores ‚ïê‚ïê -->
            <div id="home-campo" class="campo-only" style="display:none;">
                <div class="kpi-title">Tarefas do Dia</div>
                <div class="campo-grid">
                    <button class="campo-card" onclick="window.app.navigate('lotes')">
                        <span class="campo-card-icon">üêÑ</span>
                        <span class="campo-card-title">Contagem</span>
                        <span class="campo-card-sub">Conferir gado nos lotes</span>
                    </button>
                    <button class="campo-card" onclick="window.app.navigate('estoque')">
                        <span class="campo-card-icon">üì¶</span>
                        <span class="campo-card-title">Retirar Material</span>
                        <span class="campo-card-sub">Usar produto do estoque</span>
                    </button>
                    <button class="campo-card" onclick="window.app.navigate('obras')">
                        <span class="campo-card-icon">üî®</span>
                        <span class="campo-card-title">Registrar Servi√ßo</span>
                        <span class="campo-card-sub">Obra ou manuten√ß√£o</span>
                    </button>
                    <button class="campo-card" onclick="window.app.navigate('manejo')">
                        <span class="campo-card-icon">üíâ</span>
                        <span class="campo-card-title">Manejo</span>
                        <span class="campo-card-sub">Vacina ou tratamento</span>
                    </button>
                    <button class="campo-card" onclick="window.app.navigate('pastos')">
                        <span class="campo-card-icon">üåø</span>
                        <span class="campo-card-title">Pastos</span>
                        <span class="campo-card-sub">Verificar piquetes</span>
                    </button>
                    <button class="campo-card" onclick="window.app.navigate('cabecas')">
                        <span class="campo-card-icon">üè∑Ô∏è</span>
                        <span class="campo-card-title">Cabe√ßas</span>
                        <span class="campo-card-sub">Cadastro individual</span>
                    </button>
                    <button class="campo-card" style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9);"
                        onclick="window.app.navigate('mapa')">
                        <span class="campo-card-icon">üó∫Ô∏è</span>
                        <span class="campo-card-title">Mapa</span>
                        <span class="campo-card-sub">Mapa da fazenda</span>
                    </button>
                </div>
            </div>

            <!-- ‚ïê‚ïê HOME GER√äNCIA (Produtor) ‚Äî Layout completo ‚ïê‚ïê -->
            <div id="home-gerencia" class="gerencia-only">
                <!-- Bot√£o Mapa destaque -->
                <button class="mapa-home-btn" onclick="window.app.navigate('mapa')">
                    <span class="mapa-home-icon">üó∫Ô∏è</span>
                    <div class="mapa-home-text">
                        <span class="mapa-home-title">Mapa da Fazenda</span>
                        <span class="mapa-home-sub">Visualizar pastos no sat√©lite</span>
                    </div>
                    <span class="mapa-home-arrow">‚Üí</span>
                </button>

                <!-- Weather Widget -->
                <div id="clima-widget" class="clima-widget" style="display:none;"></div>

                <!-- KPI Dashboard -->
                <div class="kpi-section">
                    <div class="kpi-title">Painel da Fazenda</div>
                    <div class="kpi-grid" id="kpi-grid"></div>
                </div>

                <!-- Quick Actions ‚Äî Atalhos R√°pidos -->
                <div class="kpi-title" style="margin-top:4px;">A√ß√µes R√°pidas</div>
                <div class="home-grid">
                    <button class="home-card" onclick="window.app.navigate('compra')">
                        <div class="home-card-icon" data-icon="compraRapida"
                            style="background: linear-gradient(135deg, #0F766E, #115E59);"></div>
                        <span class="home-card-title">Compra</span>
                        <span class="home-card-sub">Registrar compra</span>
                    </button>
                    <button class="home-card" onclick="window.app.navigate('venda')">
                        <div class="home-card-icon" data-icon="vendaRapida"
                            style="background: linear-gradient(135deg, #14532D, #166534);"></div>
                        <span class="home-card-title">Venda</span>
                        <span class="home-card-sub">Registrar venda</span>
                    </button>
                    <button class="home-card" onclick="window.app.navigate('manejo')">
                        <div class="home-card-icon" data-icon="manejoRapido"
                            style="background: linear-gradient(135deg, #1E3A5F, #1E40AF);"></div>
                        <span class="home-card-title">Manejo</span>
                        <span class="home-card-sub">R√°pido</span>
                    </button>
                    <button class="home-card" onclick="window.app.navigate('estoque')">
                        <div class="home-card-icon" data-icon="abastecer"
                            style="background: linear-gradient(135deg, #78350F, #92400E);"></div>
                        <span class="home-card-title">Abastecer</span>
                        <span class="home-card-sub">Estoque</span>
                    </button>
                </div>

                <!-- Cota√ß√£o do Rebanho em P√© -->
                <div id="cotacao-rebanho" style="margin-top:16px;"></div>

                <!-- Dashboard Gr√°ficos -->
                <div id="graficos-home" style="margin-top:16px;"></div>

                <!-- Dashboard de Resultados -->
                <div id="resultados-dashboard" style="margin-top:16px;"></div>

                <!-- Atividade Recente -->
                <div id="atividade-recente" style="margin-top:16px;"></div>
            </div>

            <!-- Alerts Section (ambos perfis) -->
            <div class="alerts-section">
                <div class="alerts-title">Alertas</div>
                <div id="alerts-list"></div>
            </div>

        </section>

        <!-- view-financeiro REMOVIDO ‚Äî duplicava view-financeiro-hub -->

        <!-- ===================== COMPRA DE GADO ===================== -->
        <section id="view-compra" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('financeiro-hub')">‚Üê</button>
                <h2>Compra de Gado</h2>
            </div>
            <form id="form-compra" class="card-form">
                <div class="form-group">
                    <label>Quantidade de Animais</label>
                    <input type="number" id="compra-qty" placeholder="30" required>
                </div>
                <div class="form-group">
                    <label>Peso M√©dio (kg)</label>
                    <input type="number" id="compra-peso" step="0.1" placeholder="220">
                </div>
                <div class="form-group">
                    <label>Valor Total Pago (R$)</label>
                    <input type="number" id="compra-valor" step="0.01" placeholder="120000.00" required>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="compra-desc" placeholder="Ex: 30 Bezerros Nelore">
                </div>
                <div class="form-group">
                    <label>Fornecedor</label>
                    <input type="text" id="compra-fornecedor" placeholder="Ex: Fazenda S√£o Jo√£o">
                </div>
                <div class="form-group">
                    <label>Lote de Destino</label>
                    <select id="compra-lote">
                        <option value="">Selecionar Lote...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" id="compra-data" required>
                </div>
                <button type="submit" class="submit-btn">Registrar Compra</button>
            </form>
        </section>

        <!-- ===================== VENDA DE GADO ===================== -->
        <section id="view-venda" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('financeiro-hub')">‚Üê</button>
                <h2>Venda de Gado</h2>
            </div>
            <form id="form-venda" class="card-form">
                <div class="form-group">
                    <label>Lote</label>
                    <select id="venda-lote">
                        <option value="">Selecionar Lote...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantidade de Animais</label>
                    <input type="number" id="venda-qty" placeholder="5" required>
                </div>
                <div class="form-group">
                    <label>Peso M√©dio (kg)</label>
                    <input type="number" id="venda-peso" step="0.1" placeholder="480">
                </div>
                <div class="form-group">
                    <label>Valor Total (R$)</label>
                    <input type="number" id="venda-valor" step="0.01" placeholder="25000.00" required>
                </div>
                <div class="form-group">
                    <label>Comprador</label>
                    <input type="text" id="venda-comprador" placeholder="Ex: Frigor√≠fico XYZ">
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <input type="text" id="venda-desc" placeholder="Ex: Venda 5 Bois Gordos">
                </div>
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" id="venda-data" required>
                </div>
                <button type="submit" class="submit-btn">Registrar Venda</button>
            </form>
        </section>

        <!-- ===================== REBANHO ===================== -->
        <section id="view-rebanho" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('rebanho-hub')">‚Üê</button>
                <h2>Cadastro de Rebanho</h2>
            </div>
            <!-- Tabs -->
            <div class="tab-bar">
                <button class="tab-btn active"
                    onclick="window.rebanho.switchTab('individual', this)">Individual</button>
                <button class="tab-btn" onclick="window.rebanho.switchTab('lote', this)">Por Lote</button>
            </div>

            <!-- Tab: Individual -->
            <form id="form-rebanho" class="card-form tab-content active" data-tab="individual">
                <div class="form-row">
                    <div class="form-group">
                        <label>Brinco / ID</label>
                        <input type="text" id="reb-brinco" placeholder="Ex: B-001" required>
                    </div>
                    <div class="form-group">
                        <label>Ra√ßa</label>
                        <select id="reb-raca">
                            <option value="Nelore">Nelore</option>
                            <option value="Angus">Angus</option>
                            <option value="Brahman">Brahman</option>
                            <option value="Gir">Gir</option>
                            <option value="Girolando">Girolando</option>
                            <option value="Tabapu√£">Tabapu√£</option>
                            <option value="Senepol">Senepol</option>
                            <option value="Mesti√ßo">Mesti√ßo</option>
                            <option value="Outra">Outra</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Sexo</label>
                        <select id="reb-sexo">
                            <option value="macho">‚ôÇ Macho</option>
                            <option value="femea">‚ôÄ F√™mea</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Peso Atual (kg)</label>
                        <input type="number" id="reb-peso" step="0.1" placeholder="220">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Data Nascimento</label>
                        <input type="date" id="reb-nascimento">
                    </div>
                    <div class="form-group">
                        <label>Origem</label>
                        <select id="reb-origem">
                            <option value="compra">Compra</option>
                            <option value="nascimento">Nascimento</option>
                            <option value="doacao">Doa√ß√£o</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Lote</label>
                    <select id="reb-lote">
                        <option value="">Sem Lote</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <input type="text" id="reb-obs" placeholder="Opcional">
                </div>
                <button type="submit" class="submit-btn">Cadastrar Animal</button>
            </form>

            <!-- Tab: Por Lote (cadastro em grupo) -->
            <form id="form-rebanho-lote" class="card-form tab-content" data-tab="lote" style="display:none;">
                <div class="form-group">
                    <label>Nome / Identifica√ß√£o do Lote</label>
                    <input type="text" id="reb-lote-nome" placeholder="Ex: Lote Compra Jan/2026" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantidade de Animais</label>
                        <input type="number" id="reb-lote-qtd" placeholder="30" required>
                    </div>
                    <div class="form-group">
                        <label>Ra√ßa Predominante</label>
                        <select id="reb-lote-raca">
                            <option value="Nelore">Nelore</option>
                            <option value="Angus">Angus</option>
                            <option value="Brahman">Brahman</option>
                            <option value="Gir">Gir</option>
                            <option value="Girolando">Girolando</option>
                            <option value="Tabapu√£">Tabapu√£</option>
                            <option value="Senepol">Senepol</option>
                            <option value="Mesti√ßo">Mesti√ßo</option>
                            <option value="Outra">Outra</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Peso M√©dio (kg)</label>
                        <input type="number" id="reb-lote-peso" step="0.1" placeholder="220">
                    </div>
                    <div class="form-group">
                        <label>Idade M√©dia (meses)</label>
                        <input type="number" id="reb-lote-idade" placeholder="18">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Sexo Predominante</label>
                        <select id="reb-lote-sexo">
                            <option value="macho">‚ôÇ Machos</option>
                            <option value="femea">‚ôÄ F√™meas</option>
                            <option value="misto">‚ö§ Misto</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Origem</label>
                        <select id="reb-lote-origem">
                            <option value="compra">Compra</option>
                            <option value="nascimento">Nascimento</option>
                            <option value="doacao">Doa√ß√£o</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Lote Destino</label>
                    <select id="reb-lote-destino">
                        <option value="">Sem Lote</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <input type="text" id="reb-lote-obs" placeholder="Opcional">
                </div>
                <button type="submit" class="submit-btn">Cadastrar Lote de Animais</button>
            </form>

            <div class="section-title" style="margin-top:24px;">Rebanho Atual</div>
            <div id="rebanho-list"></div>
        </section>

        <!-- ===================== LOTES ===================== -->
        <section id="view-lotes" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('rebanho-hub')">‚Üê</button>
                <h2>Gest√£o de Lotes</h2>
            </div>
            <form id="form-lote" class="card-form">
                <div class="form-group">
                    <label>Nome do Lote</label>
                    <input type="text" id="lote-nome" placeholder="Ex: Lote S√£o Jo√£o" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="lote-categoria">
                            <option value="cria">üêÆ Cria</option>
                            <option value="recria">üêÇ Recria</option>
                            <option value="engorda">ü•© Engorda</option>
                            <option value="matrizes">üêÑ Matrizes</option>
                            <option value="touros">üêÉ Touros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Qtd Animais</label>
                        <input type="number" id="lote-qtd" placeholder="30" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Ra√ßa Predominante</label>
                    <select id="lote-raca">
                        <option value="">Selecionar...</option>
                        <option value="Nelore">Nelore</option>
                        <option value="Angus">Angus</option>
                        <option value="Nelore x Angus">Nelore x Angus</option>
                        <option value="Brahman">Brahman</option>
                        <option value="Gir">Gir</option>
                        <option value="Girolando">Girolando</option>
                        <option value="Tabapu√£">Tabapu√£</option>
                        <option value="Senepol">Senepol</option>
                        <option value="Nelore PO">Nelore PO</option>
                        <option value="Mesti√ßo">Mesti√ßo</option>
                        <option value="Outra">Outra</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Peso M√©dio (kg)</label>
                        <input type="number" id="lote-peso-medio" step="0.1" placeholder="220">
                    </div>
                    <div class="form-group">
                        <label>Pasto Atual</label>
                        <select id="lote-pasto">
                            <option value="">Selecionar...</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Data de Entrada</label>
                    <input type="date" id="lote-data-entrada">
                </div>
                <div class="section-title" style="margin-top:12px;">Nutri√ß√£o do Lote</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Sal Mineral</label>
                        <select id="lote-sal">
                            <option value="">Nenhum</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Consumo Sal (g/cab/dia)</label>
                        <input type="number" id="lote-sal-consumo" step="0.1" placeholder="80">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Ra√ß√£o</label>
                        <select id="lote-racao">
                            <option value="">Nenhuma</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Consumo Ra√ß√£o (kg/cab/dia)</label>
                        <input type="number" id="lote-racao-consumo" step="0.1" placeholder="2.5">
                    </div>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <input type="text" id="lote-obs" placeholder="Opcional">
                </div>
                <button type="submit" class="submit-btn">Cadastrar Lote</button>
            </form>
            <div class="section-title" style="margin-top:24px;">Lotes Ativos</div>
            <div id="lotes-list"></div>
            <div id="indicadores-produtivos" style="margin-top:16px;"></div>
            <div style="display:flex; gap:8px; margin-top:16px;">
                <button type="button" class="submit-btn" style="flex:1;"
                    onclick="window.relatorio.relatorioLotes('pdf')">üìÑ Salvar PDF</button>
                <button type="button" class="submit-btn"
                    style="flex:1; background:linear-gradient(135deg,#1E3A5F,#1E40AF);"
                    onclick="window.relatorio.relatorioLotes('print')">üñ®Ô∏è Imprimir</button>
            </div>
        </section>

        <!-- ===================== PASTOS ===================== -->
        <section id="view-pastos" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('rebanho-hub')">‚Üê</button>
                <h2>Cadastro de Pastos</h2>
            </div>
            <form id="form-pasto" class="card-form">
                <div class="form-group">
                    <label>Nome do Pasto / Piquete</label>
                    <input type="text" id="pasto-nome" placeholder="Ex: Piquete Norte" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>√Årea (hectares)</label>
                        <input type="number" id="pasto-area" step="0.1" placeholder="15.0">
                    </div>
                    <div class="form-group">
                        <label>Capacidade (cabe√ßas)</label>
                        <input type="number" id="pasto-capacidade" placeholder="50">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo de Capim</label>
                        <select id="pasto-tipo">
                            <option value="Braqui√°ria">Braqui√°ria</option>
                            <option value="Momba√ßa">Momba√ßa</option>
                            <option value="Tifton">Tifton</option>
                            <option value="Marandu">Marandu</option>
                            <option value="Tanz√¢nia">Tanz√¢nia</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="pasto-status">
                            <option value="disponivel">üü¢ Dispon√≠vel</option>
                            <option value="ocupado">üî¥ Ocupado</option>
                            <option value="descanso">üü° Em Descanso</option>
                            <option value="manutencao">üîß Manuten√ß√£o</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <input type="text" id="pasto-obs" placeholder="Opcional">
                </div>
                <button type="submit" class="submit-btn">Cadastrar Pasto</button>
            </form>
            <div class="section-title" style="margin-top:24px;">Pastos Cadastrados</div>
            <div id="pastos-list"></div>
            <div style="display:flex; gap:8px; margin-top:16px;">
                <button type="button" class="submit-btn" style="flex:1;"
                    onclick="window.relatorio.relatorioPastos('pdf')">üìÑ Salvar PDF</button>
                <button type="button" class="submit-btn"
                    style="flex:1; background:linear-gradient(135deg,#1E3A5F,#1E40AF);"
                    onclick="window.relatorio.relatorioPastos('print')">üñ®Ô∏è Imprimir</button>
            </div>
        </section>

        <!-- ===================== ESTOQUE ===================== -->
        <section id="view-estoque" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('operacoes-hub')">‚Üê</button>
                <h2>Estoque de Insumos</h2>
            </div>
            <!-- Quick add form -->
            <form id="form-estoque" class="card-form" style="margin-bottom:16px;">
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="est-categoria" onchange="window.estoque.onCategoryChange()">
                        <option value="racao_sal">üßÇ Ra√ß√£o / Sal Mineral</option>
                        <option value="remedios">üíä Rem√©dios / Vacinas</option>
                        <option value="obras">üî® Obras / Ferramentas</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Produto</label>
                    <select id="est-produto-sugestao" onchange="window.estoque.onSuggestionSelect()">
                        <option value="">‚Äî Selecionar ou digitar abaixo ‚Äî</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Nome do Produto</label>
                    <input type="text" id="est-produto" placeholder="Ex: Sal Mineral Fosbovi" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Qtd de Sacos</label>
                        <input type="number" id="est-qty" placeholder="10" required
                            oninput="window.estoque.calcTotal()">
                    </div>
                    <div class="form-group">
                        <label>Peso por Saco (kg)</label>
                        <input type="number" id="est-peso-saco" step="0.1" placeholder="25" value="25"
                            oninput="window.estoque.calcTotal()">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Valor por Saco (R$)</label>
                        <input type="number" id="est-valor" step="0.01" placeholder="85.00"
                            oninput="window.estoque.calcTotal()">
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <input type="text" id="est-unit" placeholder="sacos" value="sacos">
                    </div>
                </div>
                <div id="est-total-preview" class="calc-preview" style="display:none;">
                </div>
                <button type="submit" class="submit-btn">Registrar Entrada</button>
            </form>
            <!-- Filter -->
            <div class="filter-bar" style="display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap;">
                <button type="button" class="filter-btn active"
                    onclick="window.estoque.filterBy('todos')">Todos</button>
                <button type="button" class="filter-btn"
                    onclick="window.estoque.filterBy('racao_sal')">Ra√ß√£o/Sal</button>
                <button type="button" class="filter-btn" onclick="window.estoque.filterBy('remedios')">Rem√©dios</button>
                <button type="button" class="filter-btn" onclick="window.estoque.filterBy('obras')">Obras</button>
            </div>
            <div id="estoque-list"></div>
            <div style="display:flex; gap:8px; margin-top:16px;">
                <button type="button" class="submit-btn" style="flex:1;"
                    onclick="window.relatorio.relatorioEstoque('pdf')">üìÑ Salvar PDF</button>
                <button type="button" class="submit-btn"
                    style="flex:1; background:linear-gradient(135deg,#1E3A5F,#1E40AF);"
                    onclick="window.relatorio.relatorioEstoque('print')">üñ®Ô∏è Imprimir</button>
            </div>
        </section>

        <!-- ===================== FLUXO DE CAIXA ===================== -->
        <section id="view-fluxo" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('financeiro-hub')">‚Üê</button>
                <h2>Fluxo de Caixa</h2>
            </div>
            <div id="fluxo-content"></div>
            <div id="indicadores-financeiros"></div>
            <div style="display:flex; gap:8px; margin-top:16px;">
                <button type="button" class="submit-btn" style="flex:1;"
                    onclick="window.relatorio.relatorioFluxo('pdf')">üìÑ Salvar PDF</button>
                <button type="button" class="submit-btn"
                    style="flex:1; background:linear-gradient(135deg,#1E3A5F,#1E40AF);"
                    onclick="window.relatorio.relatorioFluxo('print')">üñ®Ô∏è Imprimir</button>
            </div>
        </section>

        <!-- ===================== MANEJO ===================== -->
        <section id="view-manejo" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('rebanho-hub')">‚Üê</button>
                <h2>Manejo</h2>
            </div>
            <form id="form-manejo" class="card-form">
                <div class="form-group">
                    <label>Tipo de Manejo</label>
                    <select id="manejo-tipo">
                        <option value="vacinacao">ü©∫ Vacina√ß√£o / Sanit√°rio</option>
                        <option value="pesagem">‚öñÔ∏è Pesagem</option>
                        <option value="movimentacao">üîÑ Movimenta√ß√£o de Pasto</option>
                        <option value="mortalidade">‚ö†Ô∏è Mortalidade</option>
                        <option value="outro">üìù Outro</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Pasto</label>
                        <select id="manejo-pasto">
                            <option value="">Selecionar Pasto...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Lote</label>
                        <select id="manejo-lote">
                            <option value="">Selecionar Lote...</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Produto / Descri√ß√£o</label>
                    <select id="manejo-produto"
                        onchange="if(this.value==='__outro__'){document.getElementById('manejo-desc-custom').style.display='block'}else{document.getElementById('manejo-desc-custom').style.display='none'}">
                        <option value="">Selecionar do Estoque...</option>
                    </select>
                    <input type="text" id="manejo-desc-custom" placeholder="Descreva o manejo..."
                        style="display:none; margin-top:8px;">
                    <input type="hidden" id="manejo-desc" value="">
                </div>
                <div class="form-group">
                    <label>Quantidade de Animais</label>
                    <input type="number" id="manejo-qtd" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Data</label>
                    <input type="date" id="manejo-data" required>
                </div>
                <div class="section-title">Materiais Utilizados (do Estoque)</div>
                <div id="manejo-materials-list" class="materials-list"></div>
                <div class="form-group">
                    <label>Custo Estimado (R$)</label>
                    <input type="number" id="manejo-custo" step="0.01" placeholder="0,00">
                </div>
                <button type="submit" class="submit-btn">Registrar Manejo</button>
            </form>
            <div class="section-title" style="margin-top:24px;">Hist√≥rico de Manejos</div>
            <div id="manejo-history"></div>
            <div style="display:flex; gap:8px; margin-top:16px;">
                <button type="button" class="submit-btn" style="flex:1;"
                    onclick="window.relatorio.relatorioManejo('pdf')">üìÑ Salvar PDF</button>
                <button type="button" class="submit-btn"
                    style="flex:1; background:linear-gradient(135deg,#1E3A5F,#1E40AF);"
                    onclick="window.relatorio.relatorioManejo('print')">üñ®Ô∏è Imprimir</button>
            </div>
        </section>

        <!-- ===================== OBRAS ===================== -->
        <section id="view-rastreabilidade" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('operacoes-hub')">‚Üê</button>
                <h2>Rastreabilidade SISBOV</h2>
            </div>
            <div id="rastreabilidade-content">
                <!-- Rendered by JS -->
            </div>
        </section>

        <section id="view-obras" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('operacoes-hub')">‚Üê</button>
                <h2>Registrar Obra</h2>
            </div>
            <form id="form-obra" class="card-form">
                <div class="form-group">
                    <label>Nome da Obra</label>
                    <input type="text" id="obra-nome" placeholder="Ex: Cercamento Curral 2" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Data de In√≠cio</label>
                        <input type="date" id="obra-inicio" required>
                    </div>
                    <div class="form-group">
                        <label>Data de T√©rmino</label>
                        <input type="date" id="obra-fim">
                    </div>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <textarea id="obra-obs" rows="2"></textarea>
                </div>
                <div class="section-title">Empreiteiro (Opcional)</div>
                <div class="form-group">
                    <label>Nome do Empreiteiro</label>
                    <input type="text" id="obra-empreiteiro-nome" placeholder="Ex: Jo√£o da Silva / Construtora ABC">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Contato</label>
                        <input type="text" id="obra-empreiteiro-contato" placeholder="(77) 99999-0000">
                    </div>
                    <div class="form-group">
                        <label>Valor Contratado (R$)</label>
                        <input type="number" id="obra-empreiteiro-valor" step="0.01" placeholder="5000.00">
                    </div>
                </div>
                <div class="section-title">Funcion√°rios na Obra</div>
                <div id="workers-list" class="workers-grid"></div>
                <button type="button" class="add-btn" onclick="window.obras.addWorker()">+ Adicionar
                    Funcion√°rio</button>
                <div class="section-title">Materiais Utilizados (do Estoque)</div>
                <div id="obra-materials-list" class="materials-list"></div>
                <button type="submit" class="submit-btn">Registrar Obra</button>
            </form>
            <div class="section-title" style="margin-top:24px;">Obras Registradas</div>
            <div id="obras-history"></div>
        </section>

        <!-- ===================== FUNCION√ÅRIOS ===================== -->
        <section id="view-funcionarios" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('operacoes-hub')">‚Üê</button>
                <h2>Funcion√°rios</h2>
            </div>
            <form id="form-funcionario" class="card-form">
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" id="func-nome" placeholder="Ex: Jo√£o da Silva" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Fun√ß√£o</label>
                        <select id="func-funcao">
                            <option value="Pe√£o">ü§† Pe√£o</option>
                            <option value="Tratorista">üöú Tratorista</option>
                            <option value="Cercador">üîß Cercador</option>
                            <option value="Vaqueiro">üêÑ Vaqueiro</option>
                            <option value="Capataz">üëî Capataz</option>
                            <option value="Servicos Gerais">üßπ Servi√ßos Gerais</option>
                            <option value="Diarista">üìã Diarista</option>
                            <option value="Outro">üìù Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Di√°ria (R$)</label>
                        <input type="number" id="func-diaria" step="0.01" placeholder="150.00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="tel" id="func-telefone" placeholder="(xx) xxxxx-xxxx">
                </div>
                <button type="submit" class="submit-btn">‚úÖ Cadastrar Funcion√°rio</button>
            </form>
            <div class="section-title" style="margin-top:24px;">Funcion√°rios Cadastrados</div>
            <div id="funcionarios-list"></div>
            <div style="display:flex; gap:8px; margin-top:16px;">
                <button type="button" class="submit-btn" style="flex:1;"
                    onclick="window.relatorio.relatorioFuncionarios('pdf')">üìÑ Salvar PDF</button>
                <button type="button" class="submit-btn"
                    style="flex:1; background:linear-gradient(135deg,#1E3A5F,#1E40AF);"
                    onclick="window.relatorio.relatorioFuncionarios('print')">üñ®Ô∏è Imprimir</button>
            </div>
        </section>

        <!-- ===================== BALAN√áO / DRE ===================== -->
        <section id="view-balanco" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('financeiro-hub')">‚Üê</button>
                <h2>Balan√ßo & DRE</h2>
            </div>
            <div id="balanco-content"></div>
            <div style="display:flex; gap:8px; margin-top:16px;">
                <button type="button" class="submit-btn" style="flex:1;"
                    onclick="window.relatorio.gerarRelatorio('pdf')">üìÑ Salvar PDF</button>
                <button type="button" class="submit-btn"
                    style="flex:1; background:linear-gradient(135deg,#1E3A5F,#1E40AF);"
                    onclick="window.relatorio.gerarRelatorio('print')">üñ®Ô∏è Imprimir</button>
            </div>
        </section>

        <!-- ===================== CONFIGURA√á√ïES ===================== -->
        <section id="view-config" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('home')">‚Üê</button>
                <h2>Configura√ß√µes</h2>
            </div>

            <!-- Seletor de Perfil -->
            <div class="card-form">
                <div class="section-title">üë§ Perfil de Acesso</div>
                <div class="perfil-selector">
                    <button type="button" id="btn-perfil-gerencia" class="perfil-btn active"
                        onclick="window.app.setPerfil('gerencia')">
                        <span class="perfil-btn-icon">üëî</span>
                        <span class="perfil-btn-label">Ger√™ncia</span>
                        <span class="perfil-btn-desc">Acesso completo com financeiro</span>
                    </button>
                    <button type="button" id="btn-perfil-campo" class="perfil-btn"
                        onclick="window.app.setPerfil('campo')">
                        <span class="perfil-btn-icon">ü§†</span>
                        <span class="perfil-btn-label">Campo</span>
                        <span class="perfil-btn-desc">Opera√ß√µes do dia-a-dia</span>
                    </button>
                </div>
            </div>

            <div class="card-form" style="margin-top:16px;">
                <div class="section-title">Fazenda</div>
                <div class="form-group">
                    <label>Nome da Fazenda</label>
                    <input type="text" id="config-nome-fazenda" placeholder="Ex: Fazenda S√£o Jo√£o"
                        onchange="window.app.saveConfig()">
                </div>
                <div class="form-group">
                    <label>Propriet√°rio</label>
                    <input type="text" id="config-proprietario" placeholder="Nome completo"
                        onchange="window.app.saveConfig()">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Cidade</label>
                        <input type="text" id="config-cidade" placeholder="Cidade" onchange="window.app.saveConfig()">
                    </div>
                    <div class="form-group">
                        <label>Estado</label>
                        <select id="config-estado" onchange="window.app.saveConfig()">
                            <option value="">Selecione</option>
                            <option value="AC">AC</option>
                            <option value="AL">AL</option>
                            <option value="AM">AM</option>
                            <option value="AP">AP</option>
                            <option value="BA">BA</option>
                            <option value="CE">CE</option>
                            <option value="DF">DF</option>
                            <option value="ES">ES</option>
                            <option value="GO">GO</option>
                            <option value="MA">MA</option>
                            <option value="MG">MG</option>
                            <option value="MS">MS</option>
                            <option value="MT">MT</option>
                            <option value="PA">PA</option>
                            <option value="PB">PB</option>
                            <option value="PE">PE</option>
                            <option value="PI">PI</option>
                            <option value="PR">PR</option>
                            <option value="RJ">RJ</option>
                            <option value="RN">RN</option>
                            <option value="RO">RO</option>
                            <option value="RR">RR</option>
                            <option value="RS">RS</option>
                            <option value="SC">SC</option>
                            <option value="SE">SE</option>
                            <option value="SP">SP</option>
                            <option value="TO">TO</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>√Årea Total (hectares)</label>
                    <input type="number" id="config-area" step="0.1" placeholder="0" onchange="window.app.saveConfig()">
                </div>
            </div>

            <div class="card-form" style="margin-top:16px;">
                <div class="section-title">ü§ñ IA Consultor</div>
                <div class="form-group">
                    <label>Chave API do Google (Gemini)</label>
                    <div style="display:flex; gap:8px;">
                        <input type="password" id="config-api-key" placeholder="Cole sua chave AIza..." style="flex:1;"
                            onchange="window.iaConsultor.salvarChaveConfig()">
                        <button type="button" class="btn-sm" style="white-space:nowrap; background:#2563EB;"
                            onclick="var el=document.getElementById('config-api-key'); el.type = el.type==='password' ? 'text' : 'password';">üëÅÔ∏è</button>
                    </div>
                    <p class="info-note" style="margin-top:8px; font-size:11px;">
                        Crie sua chave gr√°tis em <a href="https://aistudio.google.com/apikey" target="_blank"
                            style="color:#2563EB; font-weight:600;">aistudio.google.com/apikey</a>
                    </p>
                </div>
                <button type="button" class="submit-btn" style="margin-top:8px;"
                    onclick="window.iaConsultor.testarChave()">üß™ Testar Conex√£o IA</button>
            </div>

            <div class="card-form" style="margin-top:16px;">
                <div class="section-title">Dados</div>
                <button type="button" class="submit-btn" style="margin-bottom:10px;"
                    onclick="window.app.exportData()">üì§ Exportar Dados (JSON)</button>
                <button type="button" class="submit-btn"
                    style="margin-bottom:10px; background:linear-gradient(135deg,#2563EB,#7C3AED);"
                    onclick="document.getElementById('import-file-input').click()">üì• Importar Dados (JSON)</button>
                <input type="file" id="import-file-input" accept=".json" style="display:none;"
                    onchange="window.app.importData(event)">
                <button type="button" class="submit-btn danger-btn" onclick="window.app.resetData()">Zerar Todos os
                    Dados</button>
                <p class="info-note" style="margin-top:15px;">Esta a√ß√£o apaga todos os registros. N√£o pode ser desfeita.
                </p>
            </div>

            <div class="card-form" style="margin-top:16px;">
                <div class="section-title">Sobre</div>
                <p style="font-size:12px; color:var(--text-2); line-height:1.6;">
                    <strong>AgroMacro</strong> v2.0<br>
                    Sistema de Gest√£o Pecu√°ria<br>
                    Dados salvos localmente no dispositivo
                </p>
            </div>
        </section>

        <!-- ===================== CALEND√ÅRIO SANIT√ÅRIO ===================== -->
        <section id="view-calendario" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('rebanho-hub')">‚Üê</button>
                <h2>Calend√°rio Sanit√°rio</h2>
            </div>
            <div id="calendario-content"></div>
            <div style="display:flex; gap:8px; margin-top:16px;">
                <button type="button" class="submit-btn" style="flex:1;"
                    onclick="window.relatorio.relatorioCalendario('pdf')">üìÑ Salvar PDF</button>
                <button type="button" class="submit-btn"
                    style="flex:1; background:linear-gradient(135deg,#1E3A5F,#1E40AF);"
                    onclick="window.relatorio.relatorioCalendario('print')">üñ®Ô∏è Imprimir</button>
            </div>
        </section>

        <!-- ===================== CONTAS A PAGAR ===================== -->
        <section id="view-contas" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('financeiro-hub')">‚Üê</button>
                <h2>Contas a Pagar</h2>
            </div>
            <div id="contas-pagar-content"></div>
            <div style="display:flex; gap:8px; margin-top:16px;">
                <button type="button" class="submit-btn" style="flex:1;"
                    onclick="window.relatorio.relatorioContas('pdf')">üìÑ Salvar PDF</button>
                <button type="button" class="submit-btn"
                    style="flex:1; background:linear-gradient(135deg,#1E3A5F,#1E40AF);"
                    onclick="window.relatorio.relatorioContas('print')">üñ®Ô∏è Imprimir</button>
            </div>
        </section>

        <!-- ===================== HUB: REBANHO ===================== -->
        <section id="view-rebanho-hub" class="view hidden">
            <div class="view-header">
                <h2>Rebanho</h2>
            </div>
            <div class="home-grid">
                <button class="home-card" onclick="window.app.navigate('lotes')">
                    <div class="home-card-icon" data-icon="lotes"
                        style="background: linear-gradient(135deg, #0F766E, #115E59);"></div>
                    <span class="home-card-title">Lotes</span>
                    <span class="home-card-sub">Gest√£o por lote</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('cabecas')">
                    <div class="home-card-icon" data-icon="cabecas"
                        style="background: linear-gradient(135deg, #155E75, #164E63);"></div>
                    <span class="home-card-title">Cabe√ßas</span>
                    <span class="home-card-sub">Individual</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('pastos')">
                    <div class="home-card-icon" data-icon="pastos"
                        style="background: linear-gradient(135deg, #14532D, #166534);"></div>
                    <span class="home-card-title">Pastos</span>
                    <span class="home-card-sub">Piquetes e rota√ß√£o</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('manejo')">
                    <div class="home-card-icon" data-icon="manejo"
                        style="background: linear-gradient(135deg, #1E3A5F, #1E40AF);"></div>
                    <span class="home-card-title">Manejo</span>
                    <span class="home-card-sub">Vacinas e pesagem</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('calendario')">
                    <div class="home-card-icon" data-icon="calendario"
                        style="background: linear-gradient(135deg, #7F1D1D, #991B1B);"></div>
                    <span class="home-card-title">Calend√°rio</span>
                    <span class="home-card-sub">Sanit√°rio</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('rebanho')">
                    <div class="home-card-icon" data-icon="indicadores"
                        style="background: linear-gradient(135deg, #1E3A5F, #0C4A6E);"></div>
                    <span class="home-card-title">Indicadores</span>
                    <span class="home-card-sub">Produtivos</span>
                </button>

            </div>
        </section>

        <!-- ===================== HUB: FINANCEIRO ===================== -->
        <section id="view-financeiro-hub" class="view hidden">
            <div class="view-header">
                <h2>Financeiro</h2>
            </div>
            <div class="home-grid">
                <button class="home-card" onclick="window.app.navigate('compra')">
                    <div class="home-card-icon" data-icon="compra"
                        style="background: linear-gradient(135deg, #0F766E, #115E59);"></div>
                    <span class="home-card-title">Compra</span>
                    <span class="home-card-sub">Compra de gado</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('venda')">
                    <div class="home-card-icon" data-icon="venda"
                        style="background: linear-gradient(135deg, #14532D, #166534);"></div>
                    <span class="home-card-title">Venda</span>
                    <span class="home-card-sub">Venda de gado</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('fluxo')">
                    <div class="home-card-icon" data-icon="fluxo"
                        style="background: linear-gradient(135deg, #1E3A5F, #1E40AF);"></div>
                    <span class="home-card-title">Fluxo</span>
                    <span class="home-card-sub">Caixa</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('balanco')">
                    <div class="home-card-icon" data-icon="balanco"
                        style="background: linear-gradient(135deg, #155E75, #164E63);"></div>
                    <span class="home-card-title">Balan√ßo</span>
                    <span class="home-card-sub">DRE</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('contas')">
                    <div class="home-card-icon" data-icon="contas"
                        style="background: linear-gradient(135deg, #78350F, #92400E);"></div>
                    <span class="home-card-title">Contas</span>
                    <span class="home-card-sub">A pagar</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('financeiro')">
                    <div class="home-card-icon" data-icon="indicadores"
                        style="background: linear-gradient(135deg, #44403C, #57534E);"></div>
                    <span class="home-card-title">Indicadores</span>
                    <span class="home-card-sub">Financeiros</span>
                </button>
            </div>
        </section>

        <!-- ===================== HUB: OPERA√á√ïES ===================== -->
        <section id="view-operacoes-hub" class="view hidden">
            <div class="view-header">
                <h2>Opera√ß√µes</h2>
            </div>
            <div class="home-grid">
                <button class="home-card" onclick="window.app.navigate('rastreabilidade')">
                    <div class="home-card-icon" data-icon="sisbov"
                        style="background: linear-gradient(135deg, #1E40AF, #3B82F6);"></div>
                    <span class="home-card-title">Rastreabilidade</span>
                    <span class="home-card-sub">SISBOV / GTA</span>
                </button>
                <button class="home-card" onclick="window.balanca.abrirModoPesagem()">
                    <div class="home-card-icon" data-icon="balanca_rfid"
                        style="background: linear-gradient(135deg, #059669, #10B981);"></div>
                    <span class="home-card-title">Modo Pesagem</span>
                    <span class="home-card-sub">Balan√ßa + RFID</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('estoque')">
                    <div class="home-card-icon" data-icon="estoque"
                        style="background: linear-gradient(135deg, #78350F, #92400E);"></div>
                    <span class="home-card-title">Estoque</span>
                    <span class="home-card-sub">Insumos e ra√ß√£o</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('obras')">
                    <div class="home-card-icon" data-icon="obras"
                        style="background: linear-gradient(135deg, #44403C, #57534E);"></div>
                    <span class="home-card-title">Obras</span>
                    <span class="home-card-sub">Constru√ß√µes</span>
                </button>
                <button class="home-card" onclick="window.app.navigate('funcionarios')">
                    <div class="home-card-icon" data-icon="funcionarios"
                        style="background: linear-gradient(135deg, #0F766E, #115E59);"></div>
                    <span class="home-card-title">Funcion√°rios</span>
                    <span class="home-card-sub">Equipe</span>
                </button>
            </div>
        </section>

        <!-- ===================== CABE√áAS INDIVIDUAIS ===================== -->
        <section id="view-cabecas" class="view hidden">
            <div class="view-header">
                <button class="back-btn" onclick="window.app.navigate('rebanho-hub')">‚Üê</button>
                <h2>Cabe√ßas Individuais</h2>
            </div>

            <!-- Search + Filters -->
            <div class="search-bar" style="margin-bottom:12px;">
                <input type="text" id="cab-search" placeholder="Buscar por brinco, nome ou ra√ßa..."
                    oninput="window.cabecas.setFilter('text', this.value)">
            </div>
            <div class="filter-bar" style="display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap;">
                <button type="button" class="filter-btn active"
                    onclick="window.cabecas.setFilter('sexo','todos'); this.parentNode.querySelectorAll('.filter-btn').forEach(function(b){b.classList.remove('active')}); this.classList.add('active')">Todos</button>
                <button type="button" class="filter-btn"
                    onclick="window.cabecas.setFilter('sexo','macho'); this.parentNode.querySelectorAll('.filter-btn').forEach(function(b){b.classList.remove('active')}); this.classList.add('active')">Machos</button>
                <button type="button" class="filter-btn"
                    onclick="window.cabecas.setFilter('sexo','femea'); this.parentNode.querySelectorAll('.filter-btn').forEach(function(b){b.classList.remove('active')}); this.classList.add('active')">F√™meas</button>
                <select id="cab-filter-lote" class="filter-select"
                    onchange="window.cabecas.setFilter('lote', this.value)">
                    <option value="todos">Todos os Lotes</option>
                </select>
            </div>

            <!-- Stats -->
            <div id="cabecas-stats" class="stats-panel"></div>

            <!-- Registration Form -->
            <form id="form-cabeca" class="card-form">
                <div class="section-title">Cadastrar Animal</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>N¬∫ Brinco *</label>
                        <input type="text" id="cab-brinco" placeholder="Ex: 0123" required>
                    </div>
                    <div class="form-group">
                        <label>Chip / RFID / C√≥d. Barras</label>
                        <input type="text" id="cab-chip" placeholder="Ex: 982000...">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nome / Apelido</label>
                        <input type="text" id="cab-nome" placeholder="Opcional">
                    </div>
                    <div class="form-group">
                        <label>Tipo Identifica√ß√£o</label>
                        <select id="cab-tipo-id">
                            <option value="brinco">Brinco</option>
                            <option value="chip">Chip Eletr√¥nico</option>
                            <option value="rfid">RFID</option>
                            <option value="barras">C√≥digo de Barras</option>
                            <option value="brinco_chip">Brinco + Chip</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Sexo</label>
                        <select id="cab-sexo">
                            <option value="macho">Macho</option>
                            <option value="femea">F√™mea</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ra√ßa</label>
                        <input type="text" id="cab-raca" placeholder="Ex: Nelore">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Peso (kg)</label>
                        <input type="number" id="cab-peso" step="0.1" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>Data de Nascimento</label>
                        <input type="date" id="cab-nascimento">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Lote</label>
                        <select id="cab-lote">
                            <option value="">Sem lote</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Pasto</label>
                        <select id="cab-pasto">
                            <option value="">Sem pasto</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <input type="text" id="cab-obs" placeholder="Opcional">
                </div>
                <div class="form-group">
                    <label>üì∏ Foto do Animal</label>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input type="file" id="cab-foto" accept="image/*" capture="environment"
                            style="font-size:12px; flex:1;">
                        <img id="cab-foto-preview"
                            style="width:48px;height:48px;border-radius:8px;object-fit:cover;display:none;border:2px solid var(--green);">
                    </div>
                </div>
                <button type="submit" class="submit-btn">Cadastrar Animal</button>
            </form>

            <!-- Animal List -->
            <div class="section-title" style="margin-top:24px;">Animais Cadastrados</div>
            <div id="cabecas-list"></div>
        </section>

        <!-- ===================== MAPA INTERATIVO ===================== -->
        <section id="view-mapa" class="view hidden">
            <div class="mapa-header">
                <button class="mapa-back-btn" onclick="window.app.navigate('home')">‚Üê Voltar</button>
                <h2 class="mapa-title">üó∫Ô∏è Mapa da Fazenda</h2>
            </div>

            <!-- Mini-Dashboard -->
            <div class="mapa-dashboard">
                <div class="mapa-dash-card">
                    <span class="mapa-dash-num" id="dash-total-pastos">0</span>
                    <span class="mapa-dash-label">Pastos</span>
                </div>
                <div class="mapa-dash-card mapa-dash-green">
                    <span class="mapa-dash-num" id="dash-total-cabecas">0</span>
                    <span class="mapa-dash-label">Cabe√ßas</span>
                </div>
                <div class="mapa-dash-card mapa-dash-blue">
                    <span class="mapa-dash-num" id="dash-ocupados">0</span>
                    <span class="mapa-dash-label">Ocupados</span>
                </div>
                <div class="mapa-dash-card mapa-dash-gray">
                    <span class="mapa-dash-num" id="dash-vazios">0</span>
                    <span class="mapa-dash-label">Vazios</span>
                </div>
                <div class="mapa-dash-card"
                    style="background:linear-gradient(135deg,#f0f9ff,#e0f2fe);border-color:#0284c7;">
                    <span class="mapa-dash-num" id="dash-total-hectares" style="color:#0369a1;">0</span>
                    <span class="mapa-dash-label">üìê Hectares</span>
                </div>
            </div>

            <!-- Filtros + Busca -->
            <div class="mapa-controls">
                <div class="mapa-filters">
                    <button class="mapa-filter-btn active" onclick="window.mapa.filterMap('todos', this)">Todos</button>
                    <button class="mapa-filter-btn" onclick="window.mapa.filterMap('gado', this)">üêÑ Com Gado</button>
                    <button class="mapa-filter-btn" onclick="window.mapa.filterMap('obra', this)">üî® Em Obra</button>
                    <button class="mapa-filter-btn" onclick="window.mapa.filterMap('vazio', this)">üåø Vazios</button>
                </div>
                <div class="mapa-search">
                    <input type="text" id="mapa-search-input" placeholder="üîç Buscar pasto..."
                        oninput="window.mapa.searchPasto(this.value)">
                </div>
            </div>

            <div id="mapa-container"></div>

            <!-- Tabela de Pastos (oculta por padr√£o) -->
            <div id="mapa-table-container" class="mapa-table-container hidden"></div>

            <!-- Toolbar -->
            <div class="mapa-toolbar">
                <button class="mapa-tool-btn" onclick="window.mapa.geolocate()" title="Minha localiza√ß√£o">
                    üìç GPS
                </button>
                <button class="mapa-tool-btn" onclick="window.mapa.importKML()"
                    title="Importar arquivo KML do Google Earth">
                    üìÇ KML
                </button>
                <button class="mapa-tool-btn" onclick="window.mapa.fitBounds()" title="Centralizar nos pastos">
                    üéØ Centralizar
                </button>
                <button class="mapa-tool-btn" onclick="window.mapa.toggleTable()" title="Ver tabela de pastos"
                    id="btn-toggle-table">
                    üìã Tabela
                </button>
                <div class="mapa-legenda">
                    <span class="legenda-item"><span class="legenda-cor" style="background:#16A34A;"></span>Com
                        gado</span>
                    <span class="legenda-item"><span class="legenda-cor" style="background:#F97316;"></span>Em
                        obra</span>
                    <span class="legenda-item"><span class="legenda-cor" style="background:#8B95A5;"></span>Vazio</span>
                    <span class="legenda-item"><span class="legenda-cor"
                            style="background:linear-gradient(90deg,#065F46,#86EFAC);"></span>Descanso</span>
                </div>
            </div>
        </section>

    </main>

    <!-- ===================== MODAL: TROCAR PASTO ===================== -->
    <div id="modal-trocar-pasto" class="agro-modal">
        <div class="agro-modal-content">
            <div class="agro-modal-header">
                <h3>Trocar Pasto</h3>
                <button class="modal-close" onclick="window.lotes.fecharModal('modal-trocar-pasto')">‚úï</button>
            </div>
            <div class="agro-modal-body">
                <p><strong>Lote:</strong> <span id="modal-tp-lote"></span></p>
                <p><strong>Pasto Atual:</strong> <span id="modal-tp-atual"></span></p>
                <div class="form-group">
                    <label>Novo Pasto</label>
                    <select id="modal-tp-novo-pasto">
                        <option value="">Selecionar...</option>
                    </select>
                </div>
            </div>
            <div class="agro-modal-footer">
                <button class="submit-btn" onclick="window.lotes.confirmarTrocaPasto()">‚úÖ Confirmar Troca</button>
            </div>
        </div>
    </div>

    <!-- ===================== MODAL: JUNTAR LOTES ===================== -->
    <div id="modal-juntar-lotes" class="agro-modal">
        <div class="agro-modal-content">
            <div class="agro-modal-header">
                <h3>Juntar Lotes</h3>
                <button class="modal-close" onclick="window.lotes.fecharModal('modal-juntar-lotes')">‚úï</button>
            </div>
            <div class="agro-modal-body">
                <p style="font-size:13px; color:#666; margin-bottom:12px;">Selecione 2 ou mais lotes para unir. Os
                    animais ser√£o somados e o peso ser√° a m√©dia ponderada.</p>
                <div id="modal-jl-lista" class="checkbox-list"></div>
                <div class="form-group" style="margin-top:12px;">
                    <label>Nome do Novo Lote</label>
                    <input type="text" id="modal-jl-novo-nome" placeholder="Ex: Lote Unificado 2026">
                </div>
            </div>
            <div class="agro-modal-footer">
                <button class="submit-btn" onclick="window.lotes.confirmarJuntarLotes()">‚úÖ Juntar Lotes</button>
            </div>
        </div>
    </div>

    <!-- ===================== MODAL: ABASTECER COCHO ===================== -->
    <div id="modal-abastecer" class="agro-modal">
        <div class="agro-modal-content">
            <div class="agro-modal-header">
                <h3>Abastecer Cocho</h3>
                <button class="modal-close" onclick="window.lotes.fecharModal('modal-abastecer')">‚úï</button>
            </div>
            <div class="agro-modal-body">
                <p><strong>Lote:</strong> <span id="modal-ab-lote"></span></p>
                <p><strong>Produto:</strong> <span id="modal-ab-tipo"></span></p>
                <input type="hidden" id="modal-ab-produto" value="">
                <p id="modal-ab-consumo-info" style="font-size:12px; color:#666; margin-bottom:10px;"></p>
                <div class="form-row">
                    <div class="form-group">
                        <label>Quantidade de Sacos</label>
                        <input type="number" id="modal-ab-sacos" placeholder="4"
                            oninput="window.lotes.calcPrevisaoAbastecimento()">
                    </div>
                    <div class="form-group">
                        <label>Kg por Saco</label>
                        <input type="number" id="modal-ab-kg-saco" value="25" step="0.5"
                            oninput="window.lotes.calcPrevisaoAbastecimento()">
                    </div>
                </div>
                <div id="modal-ab-previsao" class="previsao-box"></div>
            </div>
            <div class="agro-modal-footer">
                <button class="submit-btn" onclick="window.lotes.confirmarAbastecimento()">‚úÖ Registrar
                    Abastecimento</button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation Bar ‚Äî 5 Abas Organizadas -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="window.app.navigate('home')" id="nav-home">
            <span class="nav-icon" data-icon="home"></span>
            Home
        </button>
        <button class="nav-item" onclick="window.app.navigate('rebanho-hub')" id="nav-rebanho">
            <span class="nav-icon" data-icon="rebanho"></span>
            Rebanho
        </button>
        <button class="nav-item gerencia-only" onclick="window.app.navigate('financeiro-hub')" id="nav-financeiro">
            <span class="nav-icon" data-icon="financeiro"></span>
            Financeiro
        </button>
        <button class="nav-item" onclick="window.app.navigate('operacoes-hub')" id="nav-operacoes">
            <span class="nav-icon" data-icon="operacoes"></span>
            Opera√ß√µes
        </button>
        <button class="nav-item" onclick="window.app.navigate('config')" id="nav-config">
            <span class="nav-icon" data-icon="config"></span>
            Config
        </button>
    </nav>

    <!-- Scripts -->
    <script src="js/icons.js?v=20260212a"></script>
    <script src="js/data.js?v=20260211r"></script>
    <script src="js/rebanho.js?v=20260211r"></script>
    <script src="js/pastos.js?v=20260211r"></script>
    <script src="js/lotes.js?v=20260211r"></script>
    <script src="js/obras.js?v=20260211r"></script>
    <script src="js/manejo.js?v=20260211r"></script>
    <script src="js/financeiro.js?v=20260211r"></script>
    <script src="js/estoque.js?v=20260211r"></script>
    <script src="js/funcionarios.js?v=20260211r"></script>
    <script src="js/rebanho-ops.js?v=20260211s"></script>
    <script src="js/clima.js"></script>
    <script src="js/pasto-mgmt.js?v=20260211s"></script>
    <script src="js/calendario.js?v=20260212b"></script>
    <script src="js/graficos.js?v=20260212a"></script>
    <script src="js/relatorio.js?v=20260212a"></script>
    <script src="js/contas.js?v=20260211s"></script>
    <script src="js/indicadores.js?v=20260211s"></script>
    <script src="js/nutricao.js"></script>
    <script src="js/balanca.js"></script>
    <script src="js/blockchain.js"></script>
    <script src="js/cabecas.js?v=20260212a"></script>
    <script src="js/rastreabilidade.js"></script>
    <script src="js/fotos.js?v=20260213a"></script>
    <script src="js/fazenda-data.js?v=20260219a"></script>
    <script src="js/mapa.js?v=20260219c"></script>
    <script src="js/ia-consultor.js?v=20260219a"></script>
    <script src="js/ux-helpers.js?v=20260219a"></script>
    <script src="js/resultados.js?v=20260219a"></script>

    <script src="app.js"></script>

    <!-- Theme & Greeting Init -->
    <script>
        (function () {
            var h = new Date().getHours();

            // Light mode only ‚Äî no dark mode

            // Greeting
            var greetEl = document.getElementById('greeting-text');
            var dateEl = document.getElementById('greeting-date');
            if (greetEl) {
                if (h < 6) greetEl.textContent = 'Boa madrugada';
                else if (h < 12) greetEl.textContent = 'Bom dia';
                else if (h < 18) greetEl.textContent = 'Boa tarde';
                else greetEl.textContent = 'Boa noite';
            }
            if (dateEl) {
                var days = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
                var months = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                var now = new Date();
                dateEl.textContent = days[now.getDay()] + ', ' + now.getDate() + ' de ' + months[now.getMonth()] + ' de ' + now.getFullYear();
            }

            // Inject SVG icons into all data-icon elements
            if (window.ICONS) {
                document.querySelectorAll('[data-icon]').forEach(function (el) {
                    var key = el.getAttribute('data-icon');
                    if (window.ICONS[key]) el.innerHTML = window.ICONS[key];
                });
            }
        })();
    </script>

    <script>
        // Register Service Worker for PWA offline
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(function (reg) {
                console.log('[PWA] Service Worker registered:', reg.scope);
            }).catch(function (err) {
                console.log('[PWA] SW registration failed:', err);
            });
        }
    </script>

    <!-- IA Consultor Modal -->
    <div id="ia-modal" class="ia-modal">
        <div class="ia-modal-content">
            <div class="ia-header">
                <div class="ia-header-left">
                    <span class="ia-header-icon">ü§ñ</span>
                    <div>
                        <div class="ia-header-title">AgroIA</div>
                        <div class="ia-header-sub">Consultor Pecu√°rio ‚Ä¢ Gemini AI</div>
                    </div>
                </div>
                <div class="ia-header-actions">
                    <button class="ia-header-btn" onclick="window.iaConsultor.limparHistorico()"
                        title="Limpar">üóëÔ∏è</button>
                    <button class="ia-header-btn" onclick="window.iaConsultor.toggle()" title="Fechar">‚úï</button>
                </div>
            </div>
            <div id="ia-messages" class="ia-messages"></div>
            <div id="ia-typing" class="ia-typing" style="display:none;">
                <div class="ia-typing-dots"><span></span><span></span><span></span></div>
                <span>AgroIA est√° analisando seus dados...</span>
            </div>
            <div class="ia-input-bar">
                <input type="text" id="ia-input" class="ia-input"
                    placeholder="Pergunte sobre seu rebanho, pastos, custos..." autocomplete="off">
                <button class="ia-send-btn" onclick="window.iaConsultor._enviarDoInput()">‚û§</button>
            </div>
        </div>
    </div>
</body>

</html>